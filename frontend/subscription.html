<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Subscriptions - Trading Platform</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
      // This URL should be dynamically set by the server or deployment process in production.
      // For local development, it defaults to the common local backend URL.
      window.BACKEND_API_BASE_URL = 'http://127.0.0.1:8000'; 
    </script>
    <style>
        .subscription-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
        }
        .subscription-item:last-child {
            border-bottom: none;
        }
        .subscription-details strong {
            display: inline-block;
            min-width: 120px;
        }
        .status-active { color: var(--success-color); font-weight: bold; }
        .status-expired { color: var(--danger-color); }
        .status-pending { color: #fd7e14; /* Orange for pending */ }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <h1>Trading<span style="color: var(--primary-color);">Platform</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="exchanges.html">My Exchanges</a></li>
                    <li><h4>Trading Bots</h4></li>
                    <li><a href="strategies.html">Bot Presets / Strategies</a></li>
                    <li><a href="backtesting.html">Backtesting</a></li>
                    <li><h4>Account</h4></li>
                    <li><a href="dashboard.html#profile">Profile Settings</a></li> 
                    <li><a href="subscription.html" class="active">My Subscriptions</a></li> 
                    <li><a href="#" id="logoutButtonSidebar">Logout</a></li>
                </ul>
                <div class="theme-switch-wrapper">
                    <label class="theme-switch-label" for="themeSwitch">Dark Mode</label>
                    <label class="theme-switch">
                        <input type="checkbox" id="themeSwitch">
                        <span class="slider"></span>
                    </label>
                </div>
            </nav>
        </aside>

        <div class="main-content">
            <header class="page-header">
                <h1>My Subscriptions & Billing</h1>
            </header>

            <section class="content-area">
                <div class="card">
                    <div class="card-header">
                        <h2>Active Strategy Subscriptions</h2>
                    </div>
                    <div id="activeStrategySubscriptionsList">
                        <p>Loading active strategy subscriptions...</p>
                        <!-- JS will populate this -->
                    </div>
                    <a href="strategies.html" class="btn btn-secondary mt-2">Browse More Strategies</a>
                </div>

                <div class="card mt-2">
                    <div class="card-header">
                        <h2>Platform Subscription</h2>
                    </div>
                    <div id="platformSubscriptionDetails">
                        <p><strong>Current Plan:</strong> <span id="platformPlanName">N/A</span></p>
                        <p><strong>Status:</strong> <span id="platformPlanStatus" class="status-pending">Loading...</span></p>
                        <p><strong>Expires On:</strong> <span id="platformPlanExpiry">N/A</span></p>
                        <button id="renewPlatformSubBtn" class="btn mt-1" style="display:none;">Renew Platform Access</button>
                    </div>
                </div>
                
                <div class="card mt-2" id="paymentSection" style="display:none;">
                    <div class="card-header">
                        <h2 id="paymentSectionTitle">Payment for Subscription</h2>
                    </div>
                    <p>To complete your subscription/renewal for <strong id="paymentItemName"></strong>, please send the exact amount to the address below.</p>
                    <p><strong>Amount:</strong> <span id="paymentAmountCrypto"></span> <span id="paymentCurrency"></span></p>
                    <p><strong>Address:</strong> <code id="paymentAddress" style="background-color: var(--light-gray); padding: 5px; border-radius:3px;"></code></p>
                    <p><em>This payment window will expire at: <span id="paymentExpiryTime"></span></em></p>
                    <p><small>Gateway Charge ID: <span id="paymentGatewayChargeId"></span></small></p>
                    <button id="paymentMadeBtn" class="btn btn-success mt-1">I Have Made The Payment</button>
                    <button id="cancelPaymentBtn" class="btn btn-outline mt-1" style="margin-left:10px;">Cancel</button>
                </div>

                <div class="card mt-2">
                    <div class="card-header">
                        <h2>Payment History</h2>
                    </div>
                    <table id="paymentHistoryTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Amount (Crypto)</th>
                                <th>Currency</th>
                                <th>Status</th>
                                <th>Gateway ID</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistoryTableBody">
                            <tr><td colspan="6" style="text-align:center;">Loading payment history...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div> <!-- .main-content -->
    </div> <!-- .app-container -->

    <script src="js/auth.js"></script> <!-- For logout -->
    <script src="js/theme.js"></script> <!-- For dark mode toggle -->
    <script src="js/subscription.js"></script>
</body>
</html>
